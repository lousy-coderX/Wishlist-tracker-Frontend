import { Component, EventEmitter } from '@angular/core';
import { StarRating } from '../../services/star-rating';
import { StarRatingUtils } from '../../services/star-rating.utils';
import * as i0 from "@angular/core";
import * as i1 from "../../services/star-rating-config.service";
import * as i2 from "@angular/common";
export class StarRatingComponent extends StarRating {
    constructor(config) {
        super(config);
        //Outputs
        ///////////////////////////////////////////////////////////////////////////////////////////
        this.starClickChange = new EventEmitter();
        this.ratingChange = new EventEmitter();
        this.hoverRatingChange = new EventEmitter();
    }
    saveOnClick($event) {
        if (this.starClickChange) {
            this.starClickChange.emit($event);
        }
    }
    saveOnRatingChange($event) {
        if (this.ratingChange) {
            this.ratingChange.emit($event);
        }
    }
    saveOnHover($event) {
        if (this.hoverRatingChange) {
            this.hoverRatingChange.emit($event);
        }
    }
    /**ACCESSIBILITY **/
    //Keyboard events
    onKeyDown(event) {
        if (!this.interactionPossible()) {
            return;
        }
        const handlers = {
            //Decrement
            Minus: () => this.decrement(),
            ArrowDown: () => this.decrement(),
            ArrowLeft: () => this.decrement(),
            //Increment
            Plus: () => this.increment(),
            ArrowRight: () => this.increment(),
            ArrowUp: () => this.increment(),
            //Reset
            Backspace: () => this.reset(),
            Delete: () => this.reset(),
            Digit0: () => this.reset(),
        };
        const handleDigits = (eventCode) => {
            const dStr = 'Digit';
            const digit = parseInt(eventCode.substr(dStr.length, eventCode.length - 1), 10);
            this.rating = digit;
        };
        if (handlers[event['code']] ||
            StarRatingUtils.isDigitKeyEventCode(event['code'])) {
            if (StarRatingUtils.isDigitKeyEventCode(event['code'])) {
                handleDigits(event['code']);
            }
            else {
                handlers[event['code']]();
            }
            event.preventDefault();
            event.stopPropagation();
        }
    }
    //Hover events
    onStarHover(rating) {
        if (!this.interactionPossible() || !this.hoverEnabled) {
            return;
        }
        this.hoverRating = rating ? parseInt(rating.toString(), 10) : 0;
        //update calculated Color
        this.setColor(true);
        //fire onHoverRatingChange event
        const $event = { hoverRating: this.hoverRating };
        this.saveOnHover($event);
    }
    onStopHover() {
        if (!this.interactionPossible() || !this.hoverEnabled) {
            return;
        }
        this.hoverRating = 0;
        //update calculated Color
        this.setColor();
    }
    //Overrides
    setRating(value) {
        const initValue = this.rating;
        super.setRating(value);
        //if value changed trigger valueAccessor events and outputs
        if (initValue !== this.rating) {
            const $event = { rating: this.rating };
            this.saveOnRatingChange($event);
        }
    }
    /**
     * onStarClicked
     *
     * Is fired when a star is clicked. And updated the rating value.
     * This function returns if the disabled or readOnly
     * property is set. If provided it emits the onClick event
     * handler with the actual rating value.
     *
     * @param rating
     */
    onStarClicked(rating) {
        //fire onClick event
        if (!this.interactionPossible()) {
            return;
        }
        this.rating = rating;
        const onClickEventObject = {
            rating: this.rating,
        };
        this.saveOnClick(onClickEventObject);
    }
}
StarRatingComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: StarRatingComponent, deps: [{ token: i1.StarRatingConfigService }], target: i0.ɵɵFactoryTarget.Component });
StarRatingComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.0.0", type: StarRatingComponent, selector: "star-rating", inputs: { getHalfStarVisible: "getHalfStarVisible", getColor: "getColor", showHalfStars: "showHalfStars", hoverEnabled: "hoverEnabled", rating: "rating", step: "step", disabled: "disabled", readOnly: "readOnly", space: "space", starType: "starType", size: "size", speed: "speed", numOfStars: "numOfStars", direction: "direction", staticColor: "staticColor", labelPosition: "labelPosition", labelText: "labelText", id: "id" }, outputs: { starClickChange: "starClickChange", ratingChange: "ratingChange", hoverRatingChange: "hoverRatingChange" }, usesInheritance: true, ngImport: i0, template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (mouseleave)=\"onStopHover()\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n", directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: StarRatingComponent, decorators: [{
            type: Component,
            args: [{ selector: 'star-rating', inputs: [
                        'getHalfStarVisible',
                        'getColor',
                        'showHalfStars',
                        'hoverEnabled',
                        'rating',
                        'step',
                        'disabled',
                        'readOnly',
                        'space',
                        'starType',
                        'size',
                        'speed',
                        'numOfStars',
                        'direction',
                        'staticColor',
                        //, 'labelVisible'
                        'labelPosition',
                        'labelText',
                        'id',
                    ], outputs: ['starClickChange', 'ratingChange', 'hoverRatingChange'], template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (mouseleave)=\"onStopHover()\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n", styles: [] }]
        }], ctorParameters: function () { return [{ type: i1.StarRatingConfigService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Rhci1yYXRpbmcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hbmd1bGFyLXN0YXItcmF0aW5nL3NyYy9jb21wb25lbnRzL3N0YXItcmF0aW5nL3N0YXItcmF0aW5nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1zdGFyLXJhdGluZy9zcmMvY29tcG9uZW50cy9zdGFyLXJhdGluZy9zdGFyLXJhdGluZy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUl4RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7O0FBNkJuRSxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsVUFBVTtJQXFHakQsWUFBWSxNQUErQjtRQUN6QyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFyR2hCLFNBQVM7UUFDVCwyRkFBMkY7UUFFM0Ysb0JBQWUsR0FBNkIsSUFBSSxZQUFZLEVBQWMsQ0FBQztRQUUzRSxpQkFBWSxHQUFvQyxJQUFJLFlBQVksRUFBcUIsQ0FBQztRQUV0RixzQkFBaUIsR0FBeUMsSUFBSSxZQUFZLEVBQTBCLENBQUM7SUErRnJHLENBQUM7SUE3RkQsV0FBVyxDQUFDLE1BQWtCO1FBQzVCLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQztJQUNILENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxNQUF5QjtRQUMxQyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDaEM7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Q1AsVUFBVTt3QkFDVixNQUFNO3dCQUNOLE9BQU87d0JBQ1AsWUFBWTt3QkFDWixXQUFXO3dCQUNYLGFBQWE7d0JBQ2Isa0JBQWtCO3dCQUNsQixlQUFlO3dCQUNmLFdBQVc7d0JBQ1gsSUFBSTtxQkFDTCxXQUNRLENBQUMsaUJBQWlCLEVBQUUsY0FBYyxFQUFFLG1CQUFtQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENsaWNrRXZlbnQgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2NsaWNrLWV2ZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBIb3ZlclJhdGluZ0NoYW5nZUV2ZW50IH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9ob3Zlci1yYXRpbmctY2hhbmdlLWV2ZW50LmludGVyZmFjZSc7XG5pbXBvcnQgeyBSYXRpbmdDaGFuZ2VFdmVudCB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvcmF0aW5nLWNoYW5nZS1ldmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU3RhclJhdGluZyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXItcmF0aW5nJztcbmltcG9ydCB7IFN0YXJSYXRpbmdDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3Rhci1yYXRpbmctY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RhclJhdGluZ1V0aWxzIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3Rhci1yYXRpbmcudXRpbHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzdGFyLXJhdGluZycsXG4gIGlucHV0czogW1xuICAgICdnZXRIYWxmU3RhclZpc2libGUnLFxuICAgICdnZXRDb2xvcicsXG4gICAgJ3Nob3dIYWxmU3RhcnMnLFxuICAgICdob3ZlckVuYWJsZWQnLFxuICAgICdyYXRpbmcnLFxuICAgICdzdGVwJyxcbiAgICAnZGlzYWJsZWQnLFxuICAgICdyZWFkT25seScsXG4gICAgJ3NwYWNlJyxcbiAgICAnc3RhclR5cGUnLFxuICAgICdzaXplJyxcbiAgICAnc3BlZWQnLFxuICAgICdudW1PZlN0YXJzJyxcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAnc3RhdGljQ29sb3InLFxuICAgIC8vLCAnbGFiZWxWaXNpYmxlJ1xuICAgICdsYWJlbFBvc2l0aW9uJyxcbiAgICAnbGFiZWxUZXh0JyxcbiAgICAnaWQnLFxuICBdLFxuICBvdXRwdXRzOiBbJ3N0YXJDbGlja0NoYW5nZScsICdyYXRpbmdDaGFuZ2UnLCAnaG92ZXJSYXRpbmdDaGFuZ2UnXSxcbiAgc3R5bGVVcmxzOiBbXSxcbiAgdGVtcGxhdGVVcmw6ICdzdGFyLXJhdGluZy5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIFN0YXJSYXRpbmdDb21wb25lbnQgZXh0ZW5kcyBTdGFyUmF0aW5nIHtcbiAgLy9PdXRwdXRzXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBzdGFyQ2xpY2tDaGFuZ2U6IEV2ZW50RW1pdHRlcjxDbGlja0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2xpY2tFdmVudD4oKTtcblxuICByYXRpbmdDaGFuZ2U6IEV2ZW50RW1pdHRlcjxSYXRpbmdDaGFuZ2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFJhdGluZ0NoYW5nZUV2ZW50PigpO1xuXG4gIGhvdmVyUmF0aW5nQ2hhbmdlOiBFdmVudEVtaXR0ZXI8SG92ZXJSYXRpbmdDaGFuZ2VFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEhvdmVyUmF0aW5nQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgc2F2ZU9uQ2xpY2soJGV2ZW50OiBDbGlja0V2ZW50KSB7XG4gICAgaWYgKHRoaXMuc3RhckNsaWNrQ2hhbmdlKSB7XG4gICAgICB0aGlzLnN0YXJDbGlja0NoYW5nZS5lbWl0KCRldmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZU9uUmF0aW5nQ2hhbmdlKCRldmVudDogUmF0aW5nQ2hhbmdlRXZlbnQpIHtcbiAgICBpZiAodGhpcy5yYXRpbmdDaGFuZ2UpIHtcbiAgICAgIHRoaXMucmF0aW5nQ2hhbmdlLmVtaXQoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBzYXZlT25Ib3ZlcigkZXZlbnQ6IEhvdmVyUmF0aW5nQ2hhbmdlRXZlbnQpIHtcbiAgICBpZiAodGhpcy5ob3ZlclJhdGluZ0NoYW5nZSkge1xuICAgICAgdGhpcy5ob3ZlclJhdGluZ0NoYW5nZS5lbWl0KCRldmVudCk7XG4gICAgfVxuICB9XG5cbiAgLyoqQUNDRVNTSUJJTElUWSAqKi9cblxuICAvL0tleWJvYXJkIGV2ZW50c1xuICBvbktleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25Qb3NzaWJsZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlcnM6IGFueSA9IHtcbiAgICAgIC8vRGVjcmVtZW50XG4gICAgICBNaW51czogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcbiAgICAgIEFycm93RG93bjogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcbiAgICAgIEFycm93TGVmdDogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcblxuICAgICAgLy9JbmNyZW1lbnRcbiAgICAgIFBsdXM6ICgpID0+IHRoaXMuaW5jcmVtZW50KCksXG4gICAgICBBcnJvd1JpZ2h0OiAoKSA9PiB0aGlzLmluY3JlbWVudCgpLFxuICAgICAgQXJyb3dVcDogKCkgPT4gdGhpcy5pbmNyZW1lbnQoKSxcblxuICAgICAgLy9SZXNldFxuICAgICAgQmFja3NwYWNlOiAoKSA9PiB0aGlzLnJlc2V0KCksXG4gICAgICBEZWxldGU6ICgpID0+IHRoaXMucmVzZXQoKSxcbiAgICAgIERpZ2l0MDogKCkgPT4gdGhpcy5yZXNldCgpLFxuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVEaWdpdHMgPSAoZXZlbnRDb2RlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IGRTdHIgPSAnRGlnaXQnO1xuICAgICAgY29uc3QgZGlnaXQ6IG51bWJlciA9IHBhcnNlSW50KFxuICAgICAgICBldmVudENvZGUuc3Vic3RyKGRTdHIubGVuZ3RoLCBldmVudENvZGUubGVuZ3RoIC0gMSksXG4gICAgICAgIDEwXG4gICAgICApO1xuICAgICAgdGhpcy5yYXRpbmcgPSBkaWdpdDtcbiAgICB9O1xuXG4gICAgaWYgKFxuICAgICAgaGFuZGxlcnNbZXZlbnRbJ2NvZGUnXV0gfHxcbiAgICAgIFN0YXJSYXRpbmdVdGlscy5pc0RpZ2l0S2V5RXZlbnRDb2RlKGV2ZW50Wydjb2RlJ10pXG4gICAgKSB7XG4gICAgICBpZiAoU3RhclJhdGluZ1V0aWxzLmlzRGlnaXRLZXlFdmVudENvZGUoZXZlbnRbJ2NvZGUnXSkpIHtcbiAgICAgICAgaGFuZGxlRGlnaXRzKGV2ZW50Wydjb2RlJ10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnRbJ2NvZGUnXV0oKTtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICAvL0hvdmVyIGV2ZW50c1xuICBvblN0YXJIb3ZlcihyYXRpbmc/OiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25Qb3NzaWJsZSgpIHx8ICF0aGlzLmhvdmVyRW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaG92ZXJSYXRpbmcgPSByYXRpbmcgPyBwYXJzZUludChyYXRpbmcudG9TdHJpbmcoKSwgMTApIDogMDtcbiAgICAvL3VwZGF0ZSBjYWxjdWxhdGVkIENvbG9yXG4gICAgdGhpcy5zZXRDb2xvcih0cnVlKTtcblxuICAgIC8vZmlyZSBvbkhvdmVyUmF0aW5nQ2hhbmdlIGV2ZW50XG4gICAgY29uc3QgJGV2ZW50OiBIb3ZlclJhdGluZ0NoYW5nZUV2ZW50ID0geyBob3ZlclJhdGluZzogdGhpcy5ob3ZlclJhdGluZyB9O1xuICAgIHRoaXMuc2F2ZU9uSG92ZXIoJGV2ZW50KTtcbiAgfVxuXG4gIG9uU3RvcEhvdmVyKCkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblBvc3NpYmxlKCkgfHwgIXRoaXMuaG92ZXJFbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5ob3ZlclJhdGluZyA9IDA7XG4gICAgLy91cGRhdGUgY2FsY3VsYXRlZCBDb2xvclxuICAgIHRoaXMuc2V0Q29sb3IoKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogU3RhclJhdGluZ0NvbmZpZ1NlcnZpY2UpIHtcbiAgICBzdXBlcihjb25maWcpO1xuICB9XG5cbiAgLy9PdmVycmlkZXNcbiAgc2V0UmF0aW5nKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBpbml0VmFsdWUgPSB0aGlzLnJhdGluZztcbiAgICBzdXBlci5zZXRSYXRpbmcodmFsdWUpO1xuXG4gICAgLy9pZiB2YWx1ZSBjaGFuZ2VkIHRyaWdnZXIgdmFsdWVBY2Nlc3NvciBldmVudHMgYW5kIG91dHB1dHNcbiAgICBpZiAoaW5pdFZhbHVlICE9PSB0aGlzLnJhdGluZykge1xuICAgICAgY29uc3QgJGV2ZW50OiBSYXRpbmdDaGFuZ2VFdmVudCA9IHsgcmF0aW5nOiB0aGlzLnJhdGluZyB9O1xuICAgICAgdGhpcy5zYXZlT25SYXRpbmdDaGFuZ2UoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogb25TdGFyQ2xpY2tlZFxuICAgKlxuICAgKiBJcyBmaXJlZCB3aGVuIGEgc3RhciBpcyBjbGlja2VkLiBBbmQgdXBkYXRlZCB0aGUgcmF0aW5nIHZhbHVlLlxuICAgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgaWYgdGhlIGRpc2FibGVkIG9yIHJlYWRPbmx5XG4gICAqIHByb3BlcnR5IGlzIHNldC4gSWYgcHJvdmlkZWQgaXQgZW1pdHMgdGhlIG9uQ2xpY2sgZXZlbnRcbiAgICogaGFuZGxlciB3aXRoIHRoZSBhY3R1YWwgcmF0aW5nIHZhbHVlLlxuICAgKlxuICAgKiBAcGFyYW0gcmF0aW5nXG4gICAqL1xuICBvblN0YXJDbGlja2VkKHJhdGluZzogbnVtYmVyKTogdm9pZCB7XG4gICAgLy9maXJlIG9uQ2xpY2sgZXZlbnRcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25Qb3NzaWJsZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5yYXRpbmcgPSByYXRpbmc7XG5cbiAgICBjb25zdCBvbkNsaWNrRXZlbnRPYmplY3Q6IENsaWNrRXZlbnQgPSB7XG4gICAgICByYXRpbmc6IHRoaXMucmF0aW5nLFxuICAgIH07XG4gICAgdGhpcy5zYXZlT25DbGljayhvbkNsaWNrRXZlbnRPYmplY3QpO1xuICB9XG59XG4iLCI8ZGl2IGlkPVwie3tpZH19XCIgY2xhc3M9XCJyYXRpbmcge3tnZXRDb21wb25lbnRDbGFzc05hbWVzKCl9fVwiIHRhYmluZGV4PVwiMFwiXG4gIChrZXlkb3duKT1cIm9uS2V5RG93bigkZXZlbnQpXCIgKG1vdXNlbGVhdmUpPVwib25TdG9wSG92ZXIoKVwiPlxuICA8ZGl2ICpuZ0lmPVwibGFiZWxUZXh0XCIgY2xhc3M9XCJsYWJlbC12YWx1ZVwiPnt7bGFiZWxUZXh0fX08L2Rpdj5cbiAgPGRpdiBjbGFzcz1cInN0YXItY29udGFpbmVyXCI+XG4gICAgPGRpdiBjbGFzcz1cInN0YXJcIiAobW91c2VlbnRlcik9XCJvblN0YXJIb3ZlcihzdGFyKVwiXG4gICAgICAqbmdGb3I9XCJsZXQgc3RhciBvZiBzdGFyc1wiIChjbGljayk9XCJvblN0YXJDbGlja2VkKHN0YXIpXCI+XG4gICAgICA8aSAqbmdJZj1cIiFzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItZW1wdHkge3tjbGFzc0VtcHR5fX1cIj48L2k+XG4gICAgICA8aSAqbmdJZj1cIiFzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItaGFsZiB7e2NsYXNzSGFsZn19XCI+PC9pPlxuICAgICAgPGkgKm5nSWY9XCIhc3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWZpbGxlZCB7e2NsYXNzRmlsbGVkfX1cIj48L2k+XG4gICAgICA8c3ZnICpuZ0lmPVwic3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWVtcHR5XCI+XG4gICAgICAgIDx1c2UgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCJcbiAgICAgICAgICBbYXR0ci54bGluazpocmVmXT1cInBhdGhFbXB0eVwiPjwvdXNlPlxuICAgICAgPC9zdmc+XG4gICAgICA8c3ZnICpuZ0lmPVwic3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWhhbGZcIj5cbiAgICAgICAgPHVzZSB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgIFthdHRyLnhsaW5rOmhyZWZdPVwicGF0aEhhbGZcIj48L3VzZT5cbiAgICAgIDwvc3ZnPlxuICAgICAgPHN2ZyAqbmdJZj1cInN2Z1Zpc2libGUoKVwiIGNsYXNzPVwic3Rhci1maWxsZWRcIj5cbiAgICAgICAgPHVzZSB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgIFthdHRyLnhsaW5rOmhyZWZdPVwicGF0aEZpbGxlZFwiPjwvdXNlPlxuICAgICAgPC9zdmc+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=