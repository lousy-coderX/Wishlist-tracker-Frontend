import { Component, EventEmitter, forwardRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { StarRating } from '../../services/star-rating';
import { StarRatingUtils } from '../../services/star-rating.utils';
import * as i0 from "@angular/core";
import * as i1 from "../../services/star-rating-config.service";
import * as i2 from "@angular/common";
const STAR_RATING_CONTROL_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => StarRatingControlComponent),
    multi: true,
};
export class StarRatingControlComponent extends StarRating {
    constructor(config) {
        super(config);
        //Outputs
        ///////////////////////////////////////////////////////////////////////////////////////////
        this.starClickChange = new EventEmitter();
        this.ratingChange = new EventEmitter();
        this.hoverRatingChange = new EventEmitter();
        this.onModelChangeRegistered = false;
        this.onTouchRegistered = false;
    }
    saveOnClick($event) {
        if (this.starClickChange) {
            this.starClickChange.emit($event);
        }
    }
    saveOnRatingChange($event) {
        if (this.ratingChange) {
            this.ratingChange.emit($event);
        }
    }
    saveOnHover($event) {
        if (this.hoverRatingChange) {
            this.hoverRatingChange.emit($event);
        }
    }
    saveOnTouch() {
        if (this.onTouchRegistered) {
            this.onTouch();
        }
    }
    saveOnModelChange(value) {
        if (this.onModelChangeRegistered) {
            this.onModelChange(value);
        }
    }
    /**ACCESSIBILITY **/
    //Keyboard events
    onKeyDown(event) {
        if (!this.interactionPossible()) {
            return;
        }
        const handlers = {
            //Decrement
            Minus: () => this.decrement(),
            ArrowDown: () => this.decrement(),
            ArrowLeft: () => this.decrement(),
            //Increment
            Plus: () => this.increment(),
            ArrowRight: () => this.increment(),
            ArrowUp: () => this.increment(),
            //Reset
            Backspace: () => this.reset(),
            Delete: () => this.reset(),
            Digit0: () => this.reset(),
        };
        const handleDigits = (eventCode) => {
            const dStr = 'Digit';
            const digit = parseInt(eventCode.substr(dStr.length, eventCode.length - 1), 10);
            this.rating = digit;
        };
        if (handlers[event['code']] ||
            StarRatingUtils.isDigitKeyEventCode(event['code'])) {
            if (StarRatingUtils.isDigitKeyEventCode(event['code'])) {
                handleDigits(event['code']);
            }
            else {
                handlers[event['code']]();
            }
            event.preventDefault();
            event.stopPropagation();
        }
        this.saveOnTouch();
    }
    //Focus events
    onBlur(event) {
        this.focus = false;
        event.preventDefault();
        event.stopPropagation();
        this.saveOnTouch();
    }
    onFocus(event) {
        this.focus = true;
        event.preventDefault();
        event.stopPropagation();
        this.saveOnTouch();
    }
    //Hover events
    onStarHover(rating) {
        if (!this.interactionPossible() || !this.hoverEnabled) {
            return;
        }
        this.hoverRating = rating ? parseInt(rating.toString(), 10) : 0;
        //fire onHoverRatingChange event
        const $event = { hoverRating: this.hoverRating };
        this.saveOnHover($event);
    }
    /**Form Control - ControlValueAccessor implementation**/
    writeValue(obj) {
        this.rating = obj;
    }
    registerOnChange(fn) {
        this.onModelChange = fn;
        this.onModelChangeRegistered = true;
    }
    registerOnTouched(fn) {
        this.onTouch = fn;
        this.onTouchRegistered = true;
    }
    //Overrides
    setRating(value) {
        const initValue = this.rating;
        super.setRating(value);
        //if value changed trigger valueAccessor events and outputs
        if (initValue !== this.rating) {
            const $event = { rating: this.rating };
            this.saveOnRatingChange($event);
            this.saveOnModelChange(this.rating);
        }
    }
    /**
     * onStarClicked
     *
     * Is fired when a star is clicked. And updated the rating value.
     * This function returns if the disabled or readOnly
     * property is set. If provided it emits the onClick event
     * handler with the actual rating value.
     *
     * @param rating
     */
    onStarClicked(rating) {
        //fire onClick event
        if (!this.interactionPossible()) {
            return;
        }
        this.rating = rating;
        const onClickEventObject = {
            rating: this.rating,
        };
        this.saveOnClick(onClickEventObject);
    }
}
StarRatingControlComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: StarRatingControlComponent, deps: [{ token: i1.StarRatingConfigService }], target: i0.ɵɵFactoryTarget.Component });
StarRatingControlComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.0.0", type: StarRatingControlComponent, selector: "star-rating-control", inputs: { getHalfStarVisible: "getHalfStarVisible", getColor: "getColor", showHalfStars: "showHalfStars", hoverEnabled: "hoverEnabled", rating: "rating", step: "step", disabled: "disabled", readOnly: "readOnly", space: "space", starType: "starType", size: "size", speed: "speed", numOfStars: "numOfStars", direction: "direction", staticColor: "staticColor", labelPosition: "labelPosition", labelText: "labelText", id: "id" }, outputs: { starClickChange: "starClickChange", ratingChange: "ratingChange", hoverRatingChange: "hoverRatingChange" }, providers: [STAR_RATING_CONTROL_ACCESSOR], usesInheritance: true, ngImport: i0, template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (blur)=\"onBlur($event)\"\n  (focus)=\"onFocus($event)\" (mouseleave)=\"onStarHover(0)\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n", directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: StarRatingControlComponent, decorators: [{
            type: Component,
            args: [{ selector: 'star-rating-control', providers: [STAR_RATING_CONTROL_ACCESSOR], inputs: [
                        'getHalfStarVisible',
                        'getColor',
                        'showHalfStars',
                        'hoverEnabled',
                        'rating',
                        'step',
                        'disabled',
                        'readOnly',
                        'space',
                        'starType',
                        'size',
                        'speed',
                        'numOfStars',
                        'direction',
                        'staticColor',
                        //, 'labelVisible'
                        'labelPosition',
                        'labelText',
                        'id',
                    ], outputs: ['starClickChange', 'ratingChange', 'hoverRatingChange'], template: "<div id=\"{{id}}\" class=\"rating {{getComponentClassNames()}}\" tabindex=\"0\"\n  (keydown)=\"onKeyDown($event)\" (blur)=\"onBlur($event)\"\n  (focus)=\"onFocus($event)\" (mouseleave)=\"onStarHover(0)\">\n  <div *ngIf=\"labelText\" class=\"label-value\">{{labelText}}</div>\n  <div class=\"star-container\">\n    <div class=\"star\" (mouseenter)=\"onStarHover(star)\"\n      *ngFor=\"let star of stars\" (click)=\"onStarClicked(star)\">\n      <i *ngIf=\"!svgVisible()\" class=\"star-empty {{classEmpty}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-half {{classHalf}}\"></i>\n      <i *ngIf=\"!svgVisible()\" class=\"star-filled {{classFilled}}\"></i>\n      <svg *ngIf=\"svgVisible()\" class=\"star-empty\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathEmpty\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-half\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathHalf\"></use>\n      </svg>\n      <svg *ngIf=\"svgVisible()\" class=\"star-filled\">\n        <use xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n          [attr.xlink:href]=\"pathFilled\"></use>\n      </svg>\n    </div>\n  </div>\n</div>\n", styles: [] }]
        }], ctorParameters: function () { return [{ type: i1.StarRatingConfigService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Rhci1yYXRpbmctY29udHJvbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FuZ3VsYXItc3Rhci1yYXRpbmcvc3JjL2NvbXBvbmVudHMvc3Rhci1yYXRpbmctY29udHJvbC9zdGFyLXJhdGluZy1jb250cm9sLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYW5ndWxhci1zdGFyLXJhdGluZy9zcmMvY29tcG9uZW50cy9zdGFyLXJhdGluZy1jb250cm9sL3N0YXItcmF0aW5nLWNvbnRyb2wuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BFLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUl6RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7O0FBRW5FLE1BQU0sNEJBQTRCLEdBQUc7SUFDbkMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLDBCQUEwQixDQUFDO0lBQ3pELEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQThCRixNQUFNLE9BQU8sMEJBQ1gsU0FBUSxVQUFVO0lBNElsQixZQUFZLE1BQStCO1FBQ3pDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQTNJaEIsU0FBUztRQUNULDJGQUEyRjtRQUUzRixvQkFBZSxHQUE2QixJQUFJLFlBQVksRUFBYyxDQUFDO1FBRTNFLGlCQUFZLEdBQW9DLElBQUksWUFBWSxFQUFxQixDQUFDO1FBRXRGLHNCQUFpQixHQUF5QyxJQUFJLFlBQVksRUFBMEIsQ0FBQztRQUk3Riw0QkFBdUIsR0FBRyxL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O3dCQUNOLG9CQUFvQjt3QkFDcEIsVUFBVTt3QkFDVixlQUFlO3dCQUNmLGNBQWM7d0JBQ2QsUUFBUTt3QkFDUixNQUFNO3dCQUNOLFVBQVU7d0JBQ1YsVUFBVTt3QkFDVixPQUFPO3dCQUNQLFVBQVU7d0JBQ1YsTUFBTTt3QkFDTixPQUFPO3dCQUNQLFlBQVk7d0JBQ1osV0FBVzt3QkFDWCxhQUFhO3dCQUNiLGtCQUFrQjt3QkFDbEIsZUFBZTt3QkFDZixXQUFXO3dCQUNYLElBQUk7cUJBQ0wsV0FDUSxDQUFDLGlCQUFpQixFQUFFLGNBQWMsRUFBRSxtQkFBbUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBmb3J3YXJkUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBDbGlja0V2ZW50IH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9jbGljay1ldmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSG92ZXJSYXRpbmdDaGFuZ2VFdmVudCB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvaG92ZXItcmF0aW5nLWNoYW5nZS1ldmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUmF0aW5nQ2hhbmdlRXZlbnQgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL3JhdGluZy1jaGFuZ2UtZXZlbnQuaW50ZXJmYWNlJztcbmltcG9ydCB7IFN0YXJSYXRpbmcgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdGFyLXJhdGluZyc7XG5pbXBvcnQgeyBTdGFyUmF0aW5nQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXItcmF0aW5nLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IFN0YXJSYXRpbmdVdGlscyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3N0YXItcmF0aW5nLnV0aWxzJztcblxuY29uc3QgU1RBUl9SQVRJTkdfQ09OVFJPTF9BQ0NFU1NPUiA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFN0YXJSYXRpbmdDb250cm9sQ29tcG9uZW50KSxcbiAgbXVsdGk6IHRydWUsXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzdGFyLXJhdGluZy1jb250cm9sJyxcbiAgcHJvdmlkZXJzOiBbU1RBUl9SQVRJTkdfQ09OVFJPTF9BQ0NFU1NPUl0sXG4gIGlucHV0czogW1xuICAgICdnZXRIYWxmU3RhclZpc2libGUnLFxuICAgICdnZXRDb2xvcicsXG4gICAgJ3Nob3dIYWxmU3RhcnMnLFxuICAgICdob3ZlckVuYWJsZWQnLFxuICAgICdyYXRpbmcnLFxuICAgICdzdGVwJyxcbiAgICAnZGlzYWJsZWQnLFxuICAgICdyZWFkT25seScsXG4gICAgJ3NwYWNlJyxcbiAgICAnc3RhclR5cGUnLFxuICAgICdzaXplJyxcbiAgICAnc3BlZWQnLFxuICAgICdudW1PZlN0YXJzJyxcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAnc3RhdGljQ29sb3InLFxuICAgIC8vLCAnbGFiZWxWaXNpYmxlJ1xuICAgICdsYWJlbFBvc2l0aW9uJyxcbiAgICAnbGFiZWxUZXh0JyxcbiAgICAnaWQnLFxuICBdLFxuICBvdXRwdXRzOiBbJ3N0YXJDbGlja0NoYW5nZScsICdyYXRpbmdDaGFuZ2UnLCAnaG92ZXJSYXRpbmdDaGFuZ2UnXSxcbiAgc3R5bGVVcmxzOiBbXSxcbiAgdGVtcGxhdGVVcmw6ICdzdGFyLXJhdGluZy1jb250cm9sLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgU3RhclJhdGluZ0NvbnRyb2xDb21wb25lbnRcbiAgZXh0ZW5kcyBTdGFyUmF0aW5nXG4gIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xuICAvL091dHB1dHNcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIHN0YXJDbGlja0NoYW5nZTogRXZlbnRFbWl0dGVyPENsaWNrRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxDbGlja0V2ZW50PigpO1xuXG4gIHJhdGluZ0NoYW5nZTogRXZlbnRFbWl0dGVyPFJhdGluZ0NoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8UmF0aW5nQ2hhbmdlRXZlbnQ+KCk7XG5cbiAgaG92ZXJSYXRpbmdDaGFuZ2U6IEV2ZW50RW1pdHRlcjxIb3ZlclJhdGluZ0NoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SG92ZXJSYXRpbmdDaGFuZ2VFdmVudD4oKTtcblxuICBvblRvdWNoOiBGdW5jdGlvbjtcbiAgb25Nb2RlbENoYW5nZTogRnVuY3Rpb247XG4gIHByaXZhdGUgb25Nb2RlbENoYW5nZVJlZ2lzdGVyZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBvblRvdWNoUmVnaXN0ZXJlZCA9IGZhbHNlO1xuXG4gIHNhdmVPbkNsaWNrKCRldmVudDogQ2xpY2tFdmVudCkge1xuICAgIGlmICh0aGlzLnN0YXJDbGlja0NoYW5nZSkge1xuICAgICAgdGhpcy5zdGFyQ2xpY2tDaGFuZ2UuZW1pdCgkZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIHNhdmVPblJhdGluZ0NoYW5nZSgkZXZlbnQ6IFJhdGluZ0NoYW5nZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMucmF0aW5nQ2hhbmdlKSB7XG4gICAgICB0aGlzLnJhdGluZ0NoYW5nZS5lbWl0KCRldmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2F2ZU9uSG92ZXIoJGV2ZW50OiBIb3ZlclJhdGluZ0NoYW5nZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaG92ZXJSYXRpbmdDaGFuZ2UpIHtcbiAgICAgIHRoaXMuaG92ZXJSYXRpbmdDaGFuZ2UuZW1pdCgkZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIHNhdmVPblRvdWNoKCkge1xuICAgIGlmICh0aGlzLm9uVG91Y2hSZWdpc3RlcmVkKSB7XG4gICAgICB0aGlzLm9uVG91Y2goKTtcbiAgICB9XG4gIH1cblxuICBzYXZlT25Nb2RlbENoYW5nZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMub25Nb2RlbENoYW5nZVJlZ2lzdGVyZWQpIHtcbiAgICAgIHRoaXMub25Nb2RlbENoYW5nZSh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqQUNDRVNTSUJJTElUWSAqKi9cblxuICAvL0tleWJvYXJkIGV2ZW50c1xuICBvbktleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25Qb3NzaWJsZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlcnM6IGFueSA9IHtcbiAgICAgIC8vRGVjcmVtZW50XG4gICAgICBNaW51czogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcbiAgICAgIEFycm93RG93bjogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcbiAgICAgIEFycm93TGVmdDogKCkgPT4gdGhpcy5kZWNyZW1lbnQoKSxcblxuICAgICAgLy9JbmNyZW1lbnRcbiAgICAgIFBsdXM6ICgpID0+IHRoaXMuaW5jcmVtZW50KCksXG4gICAgICBBcnJvd1JpZ2h0OiAoKSA9PiB0aGlzLmluY3JlbWVudCgpLFxuICAgICAgQXJyb3dVcDogKCkgPT4gdGhpcy5pbmNyZW1lbnQoKSxcblxuICAgICAgLy9SZXNldFxuICAgICAgQmFja3NwYWNlOiAoKSA9PiB0aGlzLnJlc2V0KCksXG4gICAgICBEZWxldGU6ICgpID0+IHRoaXMucmVzZXQoKSxcbiAgICAgIERpZ2l0MDogKCkgPT4gdGhpcy5yZXNldCgpLFxuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVEaWdpdHMgPSAoZXZlbnRDb2RlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IGRTdHIgPSAnRGlnaXQnO1xuICAgICAgY29uc3QgZGlnaXQ6IG51bWJlciA9IHBhcnNlSW50KFxuICAgICAgICBldmVudENvZGUuc3Vic3RyKGRTdHIubGVuZ3RoLCBldmVudENvZGUubGVuZ3RoIC0gMSksXG4gICAgICAgIDEwXG4gICAgICApO1xuICAgICAgdGhpcy5yYXRpbmcgPSBkaWdpdDtcbiAgICB9O1xuXG4gICAgaWYgKFxuICAgICAgaGFuZGxlcnNbZXZlbnRbJ2NvZGUnXV0gfHxcbiAgICAgIFN0YXJSYXRpbmdVdGlscy5pc0RpZ2l0S2V5RXZlbnRDb2RlKGV2ZW50Wydjb2RlJ10pXG4gICAgKSB7XG4gICAgICBpZiAoU3RhclJhdGluZ1V0aWxzLmlzRGlnaXRLZXlFdmVudENvZGUoZXZlbnRbJ2NvZGUnXSkpIHtcbiAgICAgICAgaGFuZGxlRGlnaXRzKGV2ZW50Wydjb2RlJ10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlcnNbZXZlbnRbJ2NvZGUnXV0oKTtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICB0aGlzLnNhdmVPblRvdWNoKCk7XG4gIH1cblxuICAvL0ZvY3VzIGV2ZW50c1xuICBvbkJsdXIoZXZlbnQ6IEZvY3VzRXZlbnQpIHtcbiAgICB0aGlzLmZvY3VzID0gZmFsc2U7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnNhdmVPblRvdWNoKCk7XG4gIH1cblxuICBvbkZvY3VzKGV2ZW50OiBGb2N1c0V2ZW50KSB7XG4gICAgdGhpcy5mb2N1cyA9IHRydWU7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnNhdmVPblRvdWNoKCk7XG4gIH1cblxuICAvL0hvdmVyIGV2ZW50c1xuICBvblN0YXJIb3ZlcihyYXRpbmc/OiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25Qb3NzaWJsZSgpIHx8ICF0aGlzLmhvdmVyRW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaG92ZXJSYXRpbmcgPSByYXRpbmcgPyBwYXJzZUludChyYXRpbmcudG9TdHJpbmcoKSwgMTApIDogMDtcblxuICAgIC8vZmlyZSBvbkhvdmVyUmF0aW5nQ2hhbmdlIGV2ZW50XG4gICAgY29uc3QgJGV2ZW50OiBIb3ZlclJhdGluZ0NoYW5nZUV2ZW50ID0geyBob3ZlclJhdGluZzogdGhpcy5ob3ZlclJhdGluZyB9O1xuICAgIHRoaXMuc2F2ZU9uSG92ZXIoJGV2ZW50KTtcbiAgfVxuXG4gIC8qKkZvcm0gQ29udHJvbCAtIENvbnRyb2xWYWx1ZUFjY2Vzc29yIGltcGxlbWVudGF0aW9uKiovXG5cbiAgd3JpdGVWYWx1ZShvYmo6IGFueSk6IHZvaWQge1xuICAgIHRoaXMucmF0aW5nID0gb2JqO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlID0gZm47XG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlUmVnaXN0ZXJlZCA9IHRydWU7XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoID0gZm47XG4gICAgdGhpcy5vblRvdWNoUmVnaXN0ZXJlZCA9IHRydWU7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFN0YXJSYXRpbmdDb25maWdTZXJ2aWNlKSB7XG4gICAgc3VwZXIoY29uZmlnKTtcbiAgfVxuXG4gIC8vT3ZlcnJpZGVzXG4gIHNldFJhdGluZyh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgaW5pdFZhbHVlID0gdGhpcy5yYXRpbmc7XG4gICAgc3VwZXIuc2V0UmF0aW5nKHZhbHVlKTtcblxuICAgIC8vaWYgdmFsdWUgY2hhbmdlZCB0cmlnZ2VyIHZhbHVlQWNjZXNzb3IgZXZlbnRzIGFuZCBvdXRwdXRzXG4gICAgaWYgKGluaXRWYWx1ZSAhPT0gdGhpcy5yYXRpbmcpIHtcbiAgICAgIGNvbnN0ICRldmVudDogUmF0aW5nQ2hhbmdlRXZlbnQgPSB7IHJhdGluZzogdGhpcy5yYXRpbmcgfTtcbiAgICAgIHRoaXMuc2F2ZU9uUmF0aW5nQ2hhbmdlKCRldmVudCk7XG5cbiAgICAgIHRoaXMuc2F2ZU9uTW9kZWxDaGFuZ2UodGhpcy5yYXRpbmcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBvblN0YXJDbGlja2VkXG4gICAqXG4gICAqIElzIGZpcmVkIHdoZW4gYSBzdGFyIGlzIGNsaWNrZWQuIEFuZCB1cGRhdGVkIHRoZSByYXRpbmcgdmFsdWUuXG4gICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBpZiB0aGUgZGlzYWJsZWQgb3IgcmVhZE9ubHlcbiAgICogcHJvcGVydHkgaXMgc2V0LiBJZiBwcm92aWRlZCBpdCBlbWl0cyB0aGUgb25DbGljayBldmVudFxuICAgKiBoYW5kbGVyIHdpdGggdGhlIGFjdHVhbCByYXRpbmcgdmFsdWUuXG4gICAqXG4gICAqIEBwYXJhbSByYXRpbmdcbiAgICovXG4gIG9uU3RhckNsaWNrZWQocmF0aW5nOiBudW1iZXIpOiB2b2lkIHtcbiAgICAvL2ZpcmUgb25DbGljayBldmVudFxuICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblBvc3NpYmxlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnJhdGluZyA9IHJhdGluZztcblxuICAgIGNvbnN0IG9uQ2xpY2tFdmVudE9iamVjdDogQ2xpY2tFdmVudCA9IHtcbiAgICAgIHJhdGluZzogdGhpcy5yYXRpbmcsXG4gICAgfTtcbiAgICB0aGlzLnNhdmVPbkNsaWNrKG9uQ2xpY2tFdmVudE9iamVjdCk7XG4gIH1cbn1cbiIsIjxkaXYgaWQ9XCJ7e2lkfX1cIiBjbGFzcz1cInJhdGluZyB7e2dldENvbXBvbmVudENsYXNzTmFtZXMoKX19XCIgdGFiaW5kZXg9XCIwXCJcbiAgKGtleWRvd24pPVwib25LZXlEb3duKCRldmVudClcIiAoYmx1cik9XCJvbkJsdXIoJGV2ZW50KVwiXG4gIChmb2N1cyk9XCJvbkZvY3VzKCRldmVudClcIiAobW91c2VsZWF2ZSk9XCJvblN0YXJIb3ZlcigwKVwiPlxuICA8ZGl2ICpuZ0lmPVwibGFiZWxUZXh0XCIgY2xhc3M9XCJsYWJlbC12YWx1ZVwiPnt7bGFiZWxUZXh0fX08L2Rpdj5cbiAgPGRpdiBjbGFzcz1cInN0YXItY29udGFpbmVyXCI+XG4gICAgPGRpdiBjbGFzcz1cInN0YXJcIiAobW91c2VlbnRlcik9XCJvblN0YXJIb3ZlcihzdGFyKVwiXG4gICAgICAqbmdGb3I9XCJsZXQgc3RhciBvZiBzdGFyc1wiIChjbGljayk9XCJvblN0YXJDbGlja2VkKHN0YXIpXCI+XG4gICAgICA8aSAqbmdJZj1cIiFzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItZW1wdHkge3tjbGFzc0VtcHR5fX1cIj48L2k+XG4gICAgICA8aSAqbmdJZj1cIiFzdmdWaXNpYmxlKClcIiBjbGFzcz1cInN0YXItaGFsZiB7e2NsYXNzSGFsZn19XCI+PC9pPlxuICAgICAgPGkgKm5nSWY9XCIhc3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWZpbGxlZCB7e2NsYXNzRmlsbGVkfX1cIj48L2k+XG4gICAgICA8c3ZnICpuZ0lmPVwic3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWVtcHR5XCI+XG4gICAgICAgIDx1c2UgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCJcbiAgICAgICAgICBbYXR0ci54bGluazpocmVmXT1cInBhdGhFbXB0eVwiPjwvdXNlPlxuICAgICAgPC9zdmc+XG4gICAgICA8c3ZnICpuZ0lmPVwic3ZnVmlzaWJsZSgpXCIgY2xhc3M9XCJzdGFyLWhhbGZcIj5cbiAgICAgICAgPHVzZSB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgIFthdHRyLnhsaW5rOmhyZWZdPVwicGF0aEhhbGZcIj48L3VzZT5cbiAgICAgIDwvc3ZnPlxuICAgICAgPHN2ZyAqbmdJZj1cInN2Z1Zpc2libGUoKVwiIGNsYXNzPVwic3Rhci1maWxsZWRcIj5cbiAgICAgICAgPHVzZSB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgIFthdHRyLnhsaW5rOmhyZWZdPVwicGF0aEZpbGxlZFwiPjwvdXNlPlxuICAgICAgPC9zdmc+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=